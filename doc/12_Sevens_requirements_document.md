# 七並べゲーム 要件定義書

## 1. ゲーム概要

### 1.1 ゲーム名
七並べ（ななならべ / Sevens）

### 1.2 ゲームの説明
トランプゲームの定番、七並べ。7のカードを起点として、数字が連続するカードを順番に出していくゲームです。手札をすべて出し切ったプレイヤーが勝利となります。シンプルなルールながら戦略性が高く、相手の手札を読みながら妨害カードを温存するなど、駆け引きが楽しめる伝統的なカードゲームです。

### 1.3 ゲームの目的
- 手札をすべて出し切る（最初に出し切った人が1位）
- 戦略的にカードを出して他のプレイヤーを妨害
- パスの回数を最小限に抑える
- 順位を競い、ポイントを獲得

### 1.4 プレイ人数
- 2～5人（推奨3～4人）
- 1人（CPUとの対戦）

### 1.5 想定プレイ時間
- 1ゲーム: 3～10分
- セッション: 10～30分

---

## 2. ゲームルール

### 2.1 基本ルール
1. **使用カード**: ジョーカーを除く52枚
2. **カードの配布**: 全員に均等に配る
   - 2人: 各26枚
   - 3人: 各17枚（1枚余り→除外）
   - 4人: 各13枚
   - 5人: 各10枚（2枚余り→除外）
3. **ゲーム開始**: ダイヤの7を持っている人から開始
4. **カードを出す**: 
   - 場に出ている数字の隣接する数字を出す
   - 7は各スートの最初に出せる
   - 6は7の左、8は7の右に配置
   - 数字は A(1) ～ K(13) まで連続
5. **パス**: 
   - 出せるカードがない、または出したくない場合
   - 各プレイヤー3回までパス可能
   - 3回パスすると脱落（ゲームオーバー）
6. **勝利条件**: 手札を最初に全て出し切る
7. **順位**: 出し切った順に1位、2位、3位...

### 2.2 カード配置ルール
```
場の配置例（スペード）:
    A  2  3  4  5  6  [7]  8  9  10  J  Q  K
    ←────────────────┘  └────────────────→
    (7から左へ)           (7から右へ)

4つのスートが並行して配置:
♠ A  2  3  4  5  6  [7]  8  9  10  J  Q  K
♥ A  2  3  4  5  6  [7]  8  9  10  J  Q  K
♦ A  2  3  4  5  6  [7]  8  9  10  J  Q  K
♣ A  2  3  4  5  6  [7]  8  9  10  J  Q  K
```

### 2.3 出せるカードの条件
1. **7のカード**: いつでも出せる（各スートの起点）
2. **7の隣接カード**: 
   - 6は7の左側に出せる
   - 8は7の右側に出せる
3. **連続する数字**: 
   - 場に出ている数字の±1のカード
   - 例: 場に8があれば、7または9を出せる
   - 例: 場にQがあれば、Jまたは Kを出せる
4. **同じスート**: 同じマーク（♠♥♦♣）のみ連続可能

### 2.4 パスルール
- **パス回数**: 各プレイヤー3回まで
- **パスの選択**: 
  - 出せるカードがあっても戦略的にパス可能
  - ただしパス回数は消費される
- **3回パス後**: 
  - ゲームから脱落（強制終了）
  - 残った手札の枚数でペナルティポイント
  - 順位は最下位確定

### 2.5 得点計算（オプション）
#### 基本得点
- 1位: +10点
- 2位: +5点
- 3位: +0点
- 4位: -5点
- 脱落: -10点

#### 手札ペナルティ
- 残った手札1枚につき -1点
- 7のカード残り: -2点（ダブルペナルティ）

#### 連勝ボーナス
- 2連勝: +3点
- 3連勝: +5点
- 4連勝以上: +10点

### 2.6 戦略のポイント
1. **7の温存**: 
   - 7は各スートの起点なので重要
   - 他のプレイヤーを妨害するため、すぐに出さない戦略も有効
2. **端のカード管理**:
   - AやKは最後まで出せない可能性がある
   - 早めに出す方が安全
3. **妨害戦略**:
   - 他のプレイヤーが持っていそうなカードの前後を温存
   - 連続する数字を複数持っている場合、途中を温存
4. **パスのタイミング**:
   - 戦略的なパスは有効だが、3回の制限に注意
   - 終盤はパスを残しておくと安全

---

## 3. 画面設計

### 3.1 ゲーム開始画面
#### 表示要素
- ゲームタイトル「七並べ」
- プレイヤー人数選択（2人/3人/4人/5人）
- CPU難易度選択（イージー/ノーマル/ハード）
- ルール設定:
  - パス回数制限（3回/5回/無制限）
  - 得点計算（あり/なし）
  - スピードモード（時間制限あり）
- ゲーム開始ボタン
- ルール説明セクション
- 統計情報（勝率、平均順位など）
- 言語切替ボタン

#### レイアウト
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│       🃏 七並べ                  │
│     (Sevens / ななならべ)        │
│                                 │
│  ━━ ゲーム設定 ━━━━━━━━━━━━━   │
│                                 │
│  プレイヤー人数:                 │
│  ○ 2人  ○ 3人  ● 4人  ○ 5人    │
│                                 │
│  CPU難易度:                      │
│  ○ イージー ● ノーマル ○ ハード  │
│                                 │
│  ルール設定:                     │
│  パス回数: [3回▼]               │
│  ☑ 得点計算あり                 │
│  ☐ スピードモード（30秒制限）    │
│                                 │
│  ━━ 統計情報 ━━━━━━━━━━━━━━   │
│  総ゲーム数: 78                  │
│  勝率: 32.1%                     │
│  平均順位: 2.3位                 │
│  最長連勝: 4回                   │
│  完全勝利: 12回（パス0回）        │
│                                 │
│  ℹ️ ゲームルール                │
│  ・7を起点に数字を並べる          │
│  ・手札を全て出し切れば勝利       │
│  ・3回パスで脱落                │
│  ・戦略的に相手を妨害しよう       │
│                                 │
│      [ゲーム開始]                │
│                                 │
└─────────────────────────────────┘
```

### 3.2 ゲームプレイ画面（4人プレイ）
#### 表示要素
- **場（フィールド）**: 
  - 4スート×13枚の配置エリア
  - 出されたカードを表示
  - 出せる場所をハイライト
- **プレイヤー情報**:
  - 各プレイヤー名
  - 残り手札枚数
  - パス回数（残り回数）
  - 現在のターン表示
- **自分の手札**: 
  - カード一覧（ソート可能）
  - 出せるカードをハイライト
  - クリックで選択・出せる
- **アクションボタン**:
  - カードを出す
  - パスする
- **ゲーム情報**:
  - 現在の順位
  - ターン表示
  - 次に出せるカードのヒント

#### レイアウト
```
┌─────────────────────────────────────────┐
│  七並べ         TURN: YOU      ☰       │
├─────────────────────────────────────────┤
│                                         │
│  [CPU1]    [CPU2]    [CPU3]             │
│  💳 8枚    💳 7枚    💳 9枚             │
│  Pass:2    Pass:1    Pass:0             │
│                                         │
│  ━━━━━ 場 ━━━━━━━━━━━━━━━━━━━       │
│                                         │
│  ♠ [ ][ ][ ][ ][ ][ ][7][8][ ][ ][ ][ ][ ]│
│  ♥ [ ][ ][ ][ ][6][7][8][9][ ][ ][ ][ ][ ]│
│  ♦ [ ][ ][ ][ ][ ][ ][7][ ][ ][ ][ ][ ][ ]│
│  ♣ [ ][ ][ ][ ][ ][6][7][8][9][10][ ][ ][ ]│
│                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                         │
│  💡 出せるカード: ♠6, ♠9, ♥5, ♥10, ♦6  │
│                                         │
│  ━━━ あなたの手札（6枚） ━━━━━━━━━   │
│                                         │
│  🂡 🂣 🂦 🂩 🂮 🃅                       │
│  ♠A ♠3 ♠6 ♠9 ♠K ♥5                    │
│  ✓  -  ✓  ✓  -  ✓                     │
│                                         │
│  選択: ♠6                               │
│                                         │
│  [カードを出す]  [パス（残り3回）]       │
│                                         │
│  順位: 4/4  |  1位:CPU2  2位:CPU1      │
└─────────────────────────────────────────┘
```

### 3.3 ターン中画面
#### 表示要素
- 現在のプレイヤーをハイライト
- CPUの思考中表示
- カード選択のアニメーション
- 出されたカードの移動アニメーション

```
┌─────────────────────────────────┐
│  七並べ    TURN: CPU2 🤖  ☰     │
├─────────────────────────────────┤
│                                 │
│  [CPU1]   →[CPU2]←  [CPU3]     │
│  💳 8枚    💳 7枚    💳 9枚     │
│  Pass:2    Pass:1    Pass:0     │
│                                 │
│      💭 考え中...               │
│                                 │
│  ━━━━━ 場 ━━━━━━━━━━━━━━━    │
│  (場の表示)                      │
│                                 │
│  ━━━ あなたの手札 ━━━━━━━━━    │
│  (待機中)                        │
│                                 │
└─────────────────────────────────┘
```

### 3.4 カード出し時画面
```
┌─────────────────────────────────┐
│  七並べ    TURN: YOU      ☰     │
├─────────────────────────────────┤
│                                 │
│  CPU2 が ♥10 を出しました！      │
│                                 │
│  ♥ [ ][ ][ ][ ][6][7][8][9][10] │
│                     ↑           │
│                   ✨NEW!✨      │
│                                 │
│  CPU2 残り 6枚                   │
│                                 │
└─────────────────────────────────┘
```

### 3.5 パス時画面
```
┌─────────────────────────────────┐
│  七並べ    TURN: CPU3      ☰    │
├─────────────────────────────────┤
│                                 │
│  CPU3 がパスしました             │
│  残りパス: 2回                   │
│                                 │
│  [CPU3]                         │
│  💳 9枚                         │
│  Pass: 1 → 2 ⚠️                │
│                                 │
└─────────────────────────────────┘
```

### 3.6 ゲーム終了画面
#### 表示要素
- 最終順位表
- 各プレイヤーの結果（残り手札枚数、パス回数）
- 得点表示（得点計算ありの場合）
- 統計更新
- もう一度プレイボタン
- メインメニューボタン

#### レイアウト
```
┌─────────────────────────────────┐
│       🏆 ゲーム終了 🏆           │
├─────────────────────────────────┤
│                                 │
│  ━━━━━ 最終順位 ━━━━━━━━━━    │
│                                 │
│  🥇 1位: YOU                    │
│     残り手札: 0枚               │
│     パス回数: 1回               │
│     獲得点数: +10点             │
│                                 │
│  🥈 2位: CPU2                   │
│     残り手札: 1枚（♦K）         │
│     パス回数: 0回               │
│     獲得点数: +4点              │
│                                 │
│  🥉 3位: CPU1                   │
│     残り手札: 3枚               │
│     パス回数: 2回               │
│     獲得点数: -3点              │
│                                 │
│  4位: CPU3                      │
│     残り手札: 5枚               │
│     パス回数: 3回（脱落）        │
│     獲得点数: -15点             │
│                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                 │
│  🎉 おめでとうございます！       │
│  あなたの勝利です！              │
│                                 │
│  通算成績:                       │
│  勝利: 26回 → 27回 📈           │
│  勝率: 32.1% → 33.3%            │
│                                 │
│  [もう一度] [メインメニュー]     │
│                                 │
└─────────────────────────────────┘
```

---

## 4. 機能要件

### 4.1 ゲームフロー
1. **ゲーム開始**
   - 人数、難易度、ルール設定を選択
   - ゲーム開始ボタンをクリック

2. **カード配布**
   - 52枚（またはプレイヤー数に応じて調整）をシャッフル
   - 全員に均等に配布
   - 余りカードは除外

3. **開始プレイヤー決定**
   - ダイヤの7を持っているプレイヤーが先攻
   - ダイヤの7を自動的に場に出す

4. **ターン進行**
   - プレイヤーのターン: カード選択またはパス
   - CPUのターン: 自動判断
   - 時計回りに進行

5. **カード出し**
   - 出せるカードをハイライト表示
   - カードクリックで選択
   - 「カードを出す」ボタンで確定
   - アニメーション表示

6. **パス処理**
   - 「パス」ボタンをクリック
   - パス回数カウント
   - 3回パスで脱落判定

7. **勝敗判定**
   - 手札が0枚になったプレイヤーを順位確定
   - 全員終了または脱落で終了
   - 結果表示

8. **次のゲーム**
   - 統計更新
   - 「もう一度」で同じ設定で再開
   - 「メインメニュー」で設定変更

### 4.2 カード管理
- **デッキ生成**: 52枚のカード生成
- **シャッフル**: Fisher-Yatesアルゴリズム
- **配布**: プレイヤー数に応じた均等配布
- **ソート機能**: 
  - スート順
  - 数字順
  - 出せるカード優先
- **出せるカード判定**: 場の状態から自動判定

### 4.3 場の管理
- **4スート×13枚の配置管理**
- **7の初期配置**: 各スート中央
- **連続判定**: 出せる位置の計算
- **ビジュアル更新**: カード追加時のアニメーション

### 4.4 CPUの思考ロジック
#### イージー
- 出せるカードをランダムに選択
- 7は優先的に出す
- 妨害を考えない

#### ノーマル
- 基本戦略:
  - 端のカード（A, K）を優先
  - 7は中盤まで温存
  - 連続するカードは1枚ずつ出す
- 簡単な妨害:
  - 他プレイヤーが困りそうな時は温存

#### ハード
- 高度な戦略:
  - 7の最適な出しタイミング
  - 他プレイヤーの手札推測
  - 妨害カードの戦略的温存
  - パスの効果的な利用
- 確率計算:
  - 残りカードから出せるカード予測
  - 勝利確率の計算

### 4.5 ハイライト機能
- **出せるカード**: 緑色で囲み
- **出せない場所**: グレーアウト
- **選択中カード**: 黄色で囲み
- **7のカード**: 特別な色（金色）
- **妨害されている場所**: 赤色で表示

### 4.6 ヒント機能
- **推奨カード**: AIが推奨するカードを表示
- **理由説明**: なぜそのカードがおすすめか
- **ON/OFF切替**: 設定で無効化可能
- **初心者モード**: より詳しいヒント

### 4.7 統計機能
#### 基本統計
- 総ゲーム数
- 勝利数、2位、3位、脱落数
- 勝率
- 平均順位
- 最長連勝記録

#### 詳細統計
- パス回数の平均
- 完全勝利回数（パス0回）
- カード別の出し順統計
- プレイ時間統計
- 対CPU難易度別の勝率

#### グラフ表示
- 順位の推移
- 勝率の推移
- スート別の得意不得意

### 4.8 アニメーション
- **カード配布**: 1枚ずつ配るアニメーション
- **カード移動**: 手札から場へのスムーズな移動
- **カードフリップ**: 表裏の切り替え
- **パス表示**: パスアイコンの表示
- **勝利演出**: 1位確定時のエフェクト

---

## 5. UI/UXデザイン

### 5.1 デザインコンセプト
- **シンプル&クリーン**: 見やすい配置
- **カードゲームらしさ**: トランプのデザイン
- **分かりやすい情報**: 出せるカードが一目で分かる
- **スムーズな操作**: 直感的なカード選択

### 5.2 カラーテーマ
- **背景**: 
  - テーブル: ダークグリーン（#1a5c3a）
  - UI背景: ライトグレー（#f5f5f5）
- **カード**: 
  - 表: 白（#ffffff）
  - 裏: 青（#2c5aa0）
- **ハイライト**: 
  - 出せるカード: グリーン（#28a745）
  - 選択中: イエロー（#ffc107）
  - 7のカード: ゴールド（#ffd700）
- **テキスト**: 
  - メイン: ダークグレー（#333333）
  - アクセント: ブルー（#007bff）

### 5.3 カードデザイン
- **サイズ**: 場のカードは小さめ、手札は大きめ
- **スート**: ♠♥♦♣ 標準的なデザイン
- **数字**: A, 2-10, J, Q, K
- **色**: ♠♣=黒、♥♦=赤

### 5.4 レスポンシブ対応
- **デスクトップ（1920×1080以上）**: 
  - 横長レイアウト
  - 場を大きく表示
  - 統計パネル表示
- **タブレット（768×1024）**: 
  - カードサイズ調整
  - 場を上、手札を下
- **スマートフォン（375×667以上）**: 
  - 縦画面対応
  - 場をスクロール可能に
  - 手札を横スクロール

---

## 6. 技術仕様

### 6.1 使用技術
- **HTML5**: 構造
- **CSS3**: スタイリング、アニメーション、Grid Layout
- **JavaScript (ES6+)**: ゲームロジック
- **LocalStorage**: 統計データ保存

### 6.2 ファイル構成
```
/
├── index.html              # メインページ
├── sevens.html             # 七並べページ
├── assets/
│   ├── css/
│   │   ├── styles.css      # 共通スタイル
│   │   └── sevens.css      # 七並べ専用
│   ├── js/
│   │   ├── i18n.js         # 多言語対応
│   │   ├── game-stats.js   # 統計管理
│   │   └── sevens.js       # 七並べロジック
│   └── img/
│       └── sevens/
│           ├── cards/      # カード画像
│           └── sevens_top.jpg
└── doc/
    └── 12_Sevens_requirements_document.md
```

### 6.3 データ構造
#### ゲーム状態
```javascript
{
  players: [
    {
      id: 'player1',
      name: 'YOU',
      hand: [Card...],
      passCount: 0,
      maxPasses: 3,
      isOut: false,
      rank: null,
      isHuman: true
    },
    // ... CPU players
  ],
  
  field: {
    spades: [null, null, null, null, null, null, Card(7), null, ...],
    hearts: [null, null, null, null, null, null, Card(7), null, ...],
    diamonds: [null, null, null, null, null, null, Card(7), null, ...],
    clubs: [null, null, null, null, null, null, Card(7), null, ...]
  },
  
  currentPlayerIndex: 0,
  turn: 1,
  finishedPlayers: [],
  gamePhase: 'playing',  // setup, playing, finished
  
  settings: {
    numPlayers: 4,
    maxPasses: 3,
    scoreMode: true,
    speedMode: false,
    timeLimit: 30,
    difficulty: 'normal'
  }
}
```

#### カード構造
```javascript
{
  suit: 'spades',     // spades, hearts, diamonds, clubs
  rank: 7,            // 1(A) - 13(K)
  displayRank: '7',   // 'A', '2'-'10', 'J', 'Q', 'K'
  canPlay: true,      // 出せるかどうか
  isHighlight: false
}
```

#### 場の位置（インデックス）
```javascript
// 各スートは13枚分の配列
// インデックス: 0(A), 1(2), 2(3), ..., 6(7), ..., 12(K)
field.spades[6]  // スペードの7の位置
field.hearts[0]  // ハートのAの位置
field.diamonds[12]  // ダイヤのKの位置
```

### 6.4 主要な関数
```javascript
// カード管理
createDeck()                    // デッキ生成
shuffleDeck(deck)               // シャッフル
dealCards(deck, numPlayers)     // カード配布
sortHand(hand, sortType)        // 手札ソート

// ゲームロジック
canPlayCard(card, field)        // カードが出せるか判定
getPlayableCards(hand, field)   // 出せるカード一覧
playCard(card, field)           // カードを場に出す
pass턴(player)                   // パス処理
checkGameEnd()                  // ゲーム終了判定
calculateRanks()                // 順位計算
calculateScore(player)          // 得点計算

// 場の管理
initializeField()               // 場の初期化
placeDiamond7()                 // ダイヤの7を配置
getAdjacentPositions(suit, rank) // 隣接可能位置取得
updateFieldView()               // 場の表示更新

// CPU思考
cpuSelectCard(player, field, difficulty)  // CPUのカード選択
evaluateCard(card, gameState)   // カードの価値評価
shouldPass(player, gameState)   // パスすべきか判定
blockingStrategy(card, opponents) // 妨害戦略

// UI制御
highlightPlayableCards(cards)   // 出せるカードをハイライト
animateCardPlay(card, from, to) // カード移動アニメ
showPassAnimation(player)       // パスアニメ
updatePlayerInfo()              // プレイヤー情報更新

// 統計
updateStats(result)             // 統計更新
getWinRate()                    // 勝率取得
getAverageRank()                // 平均順位
```

---

## 7. 多言語対応

### 7.1 対応言語
- 日本語（デフォルト）
- 英語
- 中国語（簡体字）
- ヒンディー語
- スペイン語
- フランス語

### 7.2 翻訳が必要な要素
- ゲームタイトル、説明
- ルール説明
- ボタンラベル（「カードを出す」「パス」など）
- プレイヤー名（「あなた」「CPU1」など）
- ゲームメッセージ（「〜が〜を出しました」など）
- 結果メッセージ（「おめでとうございます」など）
- 統計情報のラベル
- カードのランク表示（J, Q, K）

---

## 8. テストケース

### 8.1 カード配布テスト
- 52枚の正確な配布
- プレイヤー数に応じた均等配布
- 余りカードの除外処理
- ダイヤの7の所持確認

### 8.2 ゲームロジックテスト
- 出せるカードの正確な判定
- 7の初期配置
- 連続する数字の判定
- スート別の独立性

### 8.3 パス機能テスト
- パス回数のカウント
- 3回パスで脱落
- 戦略的パスの処理

### 8.4 勝敗判定テスト
- 手札0枚で勝利
- 順位の正確な記録
- 複数人同時終了の処理
- 脱落者の順位

### 8.5 CPU動作テスト
- 各難易度での適切な判断
- 出せるカードがある時の処理
- 出せない時のパス
- 妨害戦略の実行

### 8.6 得点計算テスト
- 順位別の得点
- 手札ペナルティ
- 連勝ボーナス
- 累積得点

---

## 9. 実装優先順位

### Phase 1: 基本機能（MVP）
- カード配布とシャッフル
- 場の表示（4スート×13枚）
- 基本ルール（7から連続配置）
- 出せるカード判定
- 手札からカードを出す
- パス機能
- 勝敗判定

### Phase 2: CPU対戦
- CPU実装（イージー）
- ターン制御
- CPU思考表示
- 自動進行

### Phase 3: UI/UX改善
- カードアニメーション
- ハイライト表示
- 出せるカードの強調
- プレイヤー情報の見やすさ

### Phase 4: 戦略機能
- CPU難易度（ノーマル、ハード）
- ヒント機能
- 手札ソート
- 推奨カード表示

### Phase 5: ゲームモード拡張
- 得点計算システム
- スピードモード
- 複数ラウンド対戦
- トーナメント

### Phase 6: 統計&その他
- 詳細統計機能
- グラフ表示
- 実績システム
- 多言語対応

---

## 10. 参考資料

### 10.1 七並べルール
- 伝統的な七並べのルール
- 地域による亜種ルール
- 戦略ガイド

### 10.2 確率と戦略
- 7の出しタイミングの確率論
- 最適戦略の研究
- 妨害戦略の効果

### 10.3 デザイン参考
- カードゲームのUI
- トランプカードのデザイン
- アニメーションパターン

### 10.4 類似ゲーム
- ソリティア（配置ゲーム）
- UNO（数字の連続）
- 大富豪（カード出しゲーム）
