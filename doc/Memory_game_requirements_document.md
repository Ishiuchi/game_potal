# 実装仕様書（神経衰弱 / Memory Game）


## 変更履歴
プログラムを修正するごとに本仕様書の変更履歴も更新してください
- v1（2025/11/25）：初版作成


## 目的
HTML、CSS、JavaScript のみで動作する神経衰弱（Memory Game）を実装する。カードをめくって同じ絵柄のペアを見つけるクラシックな記憶ゲームを作成する。


## 基本要件
- ブラウザで動作する神経衰弱ゲームを作成する
- 使用技術：HTML、CSS、JavaScript（フレームワークなし）
- カード枚数：4×4（16枚、8ペア）または 4×5（20枚、10ペア）または 6×6（36枚、18ペア）から選択可能
- プレイヤーは1ターンに2枚のカードをめくる
- 2枚が一致したらカードは開いたままにし、不一致なら裏返す
- 全てのペアを見つけたらゲームクリア
- プレイ時間と手数（ターン数）を記録
- 1人プレイと2人対戦モードを実装
    - 1人プレイ：タイムアタックモード
    - 2人対戦：交互にめくり、ペアを多く見つけた方が勝ち


## UI 要件
- カードグリッドを表示（4×4、4×5、6×6から選択）
- カードは裏面と表面（絵柄）を持つ
- カード裏面：統一されたデザイン（例：ロゴ、パターン）
- カード表面：絵柄（動物、果物、記号、数字など8〜18種類）
- カードめくりアニメーション（フリップ効果）
- ゲーム情報表示
    - 経過時間（タイマー）
    - 手数（何ターン目か）
    - 1人プレイ：見つけたペア数 / 総ペア数
    - 2人対戦：各プレイヤーのスコア（見つけたペア数）
- ゲームモード選択画面
    - 1人プレイ / 2人対戦の選択
    - カード枚数の選択（Easy: 4×4、Normal: 4×5、Hard: 6×6）
    - 遊び方・ルールセクション
- ゲームクリア時のモーダル表示
    - 1人プレイ：クリアタイム、総手数、パフォーマンス評価
    - 2人対戦：勝者、各プレイヤーのスコア
- リセット・再スタートボタン
- スマホでも快適に操作できるレスポンシブデザイン
    - タップでカードをめくれる
    - カードサイズが画面に収まる


## ロジック要件
### ゲーム初期化
- カードのシャッフル
    - 絵柄を2枚ずつペアで用意
    - Fisher-Yatesアルゴリズムでランダムに配置
- タイマーのリセット
- 手数カウンターのリセット
- ゲーム状態の初期化

### カードめくり処理
- 1ターンに2枚までめくることができる
- 同じカードを2回めくることはできない
- 既にペアが成立したカードはめくれない
- 1枚目：カードを表にする
- 2枚目：カードを表にして判定
    - 一致：両方のカードを開いたままにする（マッチング成功のアニメーション）
    - 不一致：0.8〜1.2秒後に両方を裏返す（プレイヤーが記憶する時間を与える）

### ペア判定
- めくった2枚のカードの絵柄を比較
- 一致した場合：
    - カードを開いたままロックする
    - マッチングカウントを増加
    - 2人対戦時：現在のプレイヤーのスコアを加算し、もう1ターン権利を得る
    - 効果音・アニメーション（任意）
- 不一致の場合：
    - 一定時間表示した後、両方を裏返す
    - 2人対戦時：ターンを交代

### ゲームクリア判定
- 全てのペアが揃ったらゲームクリア
- タイマーを停止
- クリア画面（モーダル）を表示
    - 1人プレイ：クリアタイム、手数、評価（例：S, A, B, C）
    - 2人対戦：勝者発表、スコア比較

### タイマー機能
- ゲーム開始と同時にタイマー開始
- 経過時間を「分:秒」形式で表示
- ゲームクリア時に停止
- setInterval で1秒ごとに更新

### 2人対戦モード
- プレイヤー1とプレイヤー2が交互にプレイ
- 現在のプレイヤーを明確に表示
- ペアを見つけたプレイヤーは連続でプレイ可能
- 全ペア発見後、スコアが高い方が勝利
- 同点の場合は引き分け


## カードデザイン要件
### 絵柄の種類
- Easy（4×4、8ペア）：A~K
- Normal（4×8、16ペア）：上記 + 3,5,7,9
- Hard（4×13、26ペア）：上記 + 2,4,6,8,10

または画像ファイルを使用：
- `src/images/playing_cards/` フォルダに絵柄画像を格納
- club_A.png 〜 spade_K.png
- card-back.png（裏面デザイン）

### カードアニメーション
- フリップアニメーション（3D回転効果）
- マッチング成功時：拡大・縮小アニメーション、発光エフェクト
- 不一致時：揺れるアニメーション


## デバッグ要件
- console.log でカード配置をデバッグモードで確認可能
- カード初期化時にシャッフル結果をログ出力
- ペア判定時の結果をログ出力
- ゲームクリア時の統計情報をログ出力


## コード品質要件
- 可読性優先の変数名・関数名を使用する
- グローバル変数は必要最小限にする（ゲーム状態管理のみ）
- 重要処理に説明コメントを記述する
- マジックナンバーを避ける（定数として定義）
- カード管理、タイマー、判定ロジックを関数として分離
- 各関数は単一責任の原則に従う
- カードの状態管理は配列またはオブジェクトで統一的に管理


## ファイル構成
```
src/
├── memory.html           # メインHTML
├── memory.css            # 神経衰弱専用スタイル
├── memory.js             # ゲームロジック実装
├── game-page.css         # 共通ゲームページスタイル
├── i18n.js               # 多言語対応
├── images/
│   └── playing_cards/
│       ├── card-back.png
│       ├── club_2.png
│       ├── club_3.png
│       └── ... (spade_Q.png まで)
└── index.html            # トップページ
```


## 主要関数一覧
- `initGame()` - ゲーム初期化
- `startGame(mode, difficulty)` - ゲーム開始（モード：1人/2人、難易度：Easy/Normal/Hard）
- `shuffleCards()` - カードをシャッフル
- `renderBoard()` - カードグリッドを描画
- `handleCardClick(cardIndex)` - カードクリック処理
- `flipCard(cardIndex)` - カードをめくる
- `checkMatch()` - ペアが一致するか判定
- `lockCards()` - マッチしたカードをロック
- `resetFlippedCards()` - めくったカードを裏返す
- `switchTurn()` - ターン交代（2人対戦時）
- `updateTimer()` - タイマー更新
- `updateStatus()` - ステータス表示更新
- `checkGameComplete()` - ゲームクリア判定
- `showResults()` - 結果モーダル表示
- `resetGame()` - ゲームリセット
- `calculateRank(time, moves)` - パフォーマンス評価計算


## ゲームモード詳細
### 1人プレイモード
- タイムアタック形式
- できるだけ早く、少ない手数でクリアを目指す
- ランキング評価システム
    - Sランク：手数が最適手数の1.2倍以内、かつ時間が短い
    - Aランク：手数が最適手数の1.5倍以内
    - Bランク：手数が最適手数の2.0倍以内
    - Cランク：それ以上

### 2人対戦モード
- ターン制で交互にプレイ
- ペアを見つけたプレイヤーは連続でプレイ可能（ボーナスターン）
- 全ペア発見後、多くのペアを見つけた方が勝利
- 引き分けの場合は「Draw」と表示


## 拡張要件（オプション）
- ベストタイム・最少手数の記録（localStorage使用）
- 効果音の追加（カードめくり音、マッチング音、クリア音）
- 難易度カスタマイズ（カード枚数を自由に設定）
- テーマ選択（動物、果物、数字、記号など）
- ヒント機能（1ゲームに1回だけ使用可能、ペアの位置を一瞬表示）
- オンライン対戦機能（将来的な拡張）


## 多言語対応
i18n.jsに以下の翻訳キーを追加：
```javascript
memory: {
    pageTitle: '神経衰弱 - ゲームサイト',
    title: '🃏 神経衰弱',
    selectMode: 'ゲームモードを選択',
    onePlayer: '1人プレイ',
    twoPlayers: '2人対戦',
    selectDifficulty: '難易度を選択',
    easy: 'Easy (4×4)',
    normal: 'Normal (4×5)',
    hard: 'Hard (6×6)',
    rule1: '<strong>目的：</strong>全てのカードのペアを見つける',
    rule2: '<strong>めくり方：</strong>1ターンに2枚のカードをめくる',
    rule3: '<strong>一致：</strong>同じ絵柄ならカードは開いたまま',
    rule4: '<strong>不一致：</strong>違う絵柄なら裏返される',
    rule5: '<strong>勝利：</strong>全ペアを見つけたらクリア',
    timer: '時間:',
    moves: '手数:',
    pairs: 'ペア:',
    player1: 'プレイヤー1',
    player2: 'プレイヤー2',
    turn: 'のターン',
    backToMode: 'モード選択に戻る',
    congratulations: 'おめでとうございます！',
    clearTime: 'クリアタイム:',
    totalMoves: '総手数:',
    rank: 'ランク:',
    winner: '勝者:',
    draw: '引き分け',
    score: 'スコア:'
}
```
