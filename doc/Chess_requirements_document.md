# チェス 実装仕様書

## ドキュメント管理

### 変更履歴
| バージョン | 日付 | 変更内容 |
|:---:|:---|:---|
| v1.0 | 2025/11/25 | 初版作成 |

### 文書の目的
本仕様書は、Webポータル「GAME PORTAL」に実装する「チェス（Chess）」ゲームの要件を定義する。GitHub Copilotによる自動生成を前提とし、必要な機能・UI・ロジックを明確化する。

## 1. プロジェクト概要

### 1.1 ゲームコンセプト
- **ジャンル**: 戦略ボードゲーム
- **目的**: チェスの完全なルールに基づき、相手のキングをチェックメイトする
- **特徴**:
  - 8×8のチェスボード
  - 6種類の駒の移動ルール実装
  - 特殊ルール（キャスリング、アンパッサン、プロモーション）対応
  - 3段階のCPU対戦レベル

### 1.2 技術要件


- **使用言語**: HTML5, CSS3, JavaScript (ES6+)
- **フレームワーク**: なし（Vanilla JS）
- **ブラウザ要件**: モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版）
- **レスポンシブ対応**: PC・タブレット・スマートフォン

## 2. ゲーム仕様

### 2.1 基本ルール
- 8×8のチェスボードでプレイ
- プレイヤーは白→黒→白→…の交互ターン
- 各駒の移動ルールを完全実装:
  - **ルーク（Rook）**: 直線方向への移動
  - **ビショップ（Bishop）**: 斜め方向への移動
  - **クイーン（Queen）**: 直線+斜めの全方向
  - **ナイト（Knight）**: L字移動（障害物無視）
  - **キング（King）**: 1マス移動（全方向）
  - **ポーン（Pawn）**: 前進、斜め取り、初手2マス

### 2.2 特殊ルール
- **キャスリング**: キングとルークの同時移動
- **アンパッサン**: ポーンの特殊取り
- **プロモーション**: ポーンの昇格（クイーンに自動昇格）
- **チェック判定**: キングへの攻撃検出
- **チェックメイト判定**: 合法手なし+チェック状態
- **ステイルメイト判定**: 合法手なし+チェックなし（引き分け）

### 2.3 プレイモード
- **プレイヤー vs プレイヤー**: ローカル対戦
- **プレイヤー vs CPU**: 3段階の難易度
  - レベル1: ランダム合法手
  - レベル2: 駒価値ベースの簡易評価
  - レベル3: ミニマックス+αβ剪定（深さ2～3）

## 3. UI/UX設計


## UI 要件
- 8×8 のチェスボードを表示（白黒タイル）
- 駒は以下どちらかで描画
    - SVGアイコン（推奨）
    - テキスト絵文字（♔♕♖…）
- プレイヤーターンを画面上部に表示
- 合法手のハイライト表示
    - クリックした駒の移動可能マス
    - 攻撃可能マス（専用カラー）
- 移動履歴ログを表示
    - 例：1. e4 e5 2. Nf3 …
- ゲームモード選択画面
    - プレイヤー vs プレイヤー
    - プレイヤー vs CPU（レベル選択）
- チェック状態の視覚化（キングのタイルを赤く表示など）
- ゲーム終了時のモーダル表示
    - 勝者（Checkmate / Resign）
    - 引き分け（Stalemate / 三fold repetition / 50手ルール）
- スマホ対応のレスポンシブデザイン


## ロジック要件
### 盤面状態
- 8×8 の2次元配列
- 各セルに以下情報を保持
    - 駒の種類
    - 色（white / black）
    - 初期位置から動いたか（キャスリング判定用）
- 駒の移動処理
    - セルクリック → 駒選択
    - 合法手（possible moves）を計算
    - 選択後、別のセルをクリック → 移動処理

### 駒ごとの移動ルール
- ルーク（Rook）
    - 直線方向への移動（障害物で止まる）
- ビショップ（Bishop）
    - 斜め方向移動
- クイーン（Queen）
    - 直線 + 斜めの全方向
- ナイト（Knight）
    - L字（障害物無視）
- キング（King）
    - 1マス移動（前後左右斜め）
    - キャスリングの実装
        - キングとルークが未動作
        - 間に駒がない
        - キングが通過・終了するマスがチェックではない
- ポーン（Pawn）
    - 前進（1マス）
    - 初手のみ 2マス前進
    - 斜め前の敵駒のみ取れる
    - アンパッサンの実装
    - 昇格（クイーンに自動昇格でOK）

### 合法手判定
- 現在のプレイヤーの駒を全走査
- 移動できるマスを取得
- 移動後にキングがチェック状態になる手は排除（王手放置禁止）

### チェック判定
- 相手側の駒から見て、キングが攻撃対象かどうか

### チェックメイト判定
- 自分の合法手が 0 かつチェック中 → チェックメイト

### ステイルメイト判定
- 合法手なし
- かつキングがチェックされていない → ドロー

### 50手ルール
- 実装優先度：低（任意）
- 駒取り or ポーン移動が 50 手間ないと引き分け

### 3-fold repetition
- 同一局面が 3 回発生 → ドロー
（履歴で判定）


## CPU対戦ロジック
- レベル1（ランダム）
    - 全合法手からランダム選択
- レベル2（駒価値）
    - 各手をシミュレートしスコア計算
        - Pawn 1
        - Knight 3
        - Bishop 3
        - Rook 5
        - Queen 9
    - スコア最大の手を選択
- レベル3（ミニマックス + αβ剪定）
    - 深さ 2〜3
    - 評価関数は以下要素
        - 駒価値
        - 王の安全
        - 駒の可動性
        - 盤面の中心制圧


## デバッグ要件（任意）
- console.log に各関数の結果を出力
- move generation のログ
- チェック/メイト判定をログ表示
- CPU の評価計算を表示（任意）


## コード品質要件
- 意味の分かる関数名・変数名を使用
- グローバル変数は最小化
- コメントは重要処理に記述
- 駒ごとのmove生成関数を分離
- 評価関数は１ファイルに切り出し可能な構造にする
- Undo（局面巻き戻し）に備え、Moveオブジェクトを明確化