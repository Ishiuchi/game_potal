# 数独ゲーム 要件定義書

## 1. ゲーム概要

### 1.1 ゲーム名
数独（Sudoku）

### 1.2 ゲームの説明
9×9のグリッドに1～9の数字を配置するロジックパズルゲーム。各行、各列、各3×3のブロックに1～9の数字が重複なく入るようにマスを埋めていきます。難易度別の問題が用意され、初心者から上級者まで楽しめる人気の数字パズルです。

### 1.3 ゲームの目的
- すべてのマスに正しい数字を配置してパズルを完成させる
- タイムを競って記録を更新する
- 論理的思考力と集中力を鍛える

### 1.4 プレイ人数
1人

### 1.5 想定プレイ時間
- 簡単: 5～10分
- 普通: 10～20分
- 難しい: 20～40分
- 超難問: 40分～

---

## 2. ゲームルール

### 2.1 基本ルール
1. **グリッド構成**: 9×9のマスで構成される（81マス）
2. **3×3ブロック**: 9×9グリッドは3×3のブロック9個に分割される
3. **数字配置の制約**:
   - 各行に1～9の数字が1つずつ入る
   - 各列に1～9の数字が1つずつ入る
   - 各3×3ブロックに1～9の数字が1つずつ入る
4. **初期配置**: 一部のマスには数字が最初から入っている（固定マス）
5. **固定マスの変更不可**: 初期配置された数字は変更できない

### 2.2 操作方法
1. **マス選択**: 空いているマスをクリック/タップで選択
2. **数字入力**:
   - 数字ボタン（1～9）をクリック
   - キーボードの数字キー（1～9）で入力
3. **メモ機能**: 候補となる数字を小さく記入できる
4. **消去**: 入力した数字を削除できる
5. **ヒント**: 1マスの正解を表示する（使用回数制限あり）
6. **やり直し**: 最後の入力を取り消す（Undo機能）

### 2.3 勝利条件
- すべてのマスに正しい数字が配置され、ルールに違反していない状態

### 2.4 難易度レベル
1. **簡単（Easy）**: 初期配置40～45マス
2. **普通（Normal）**: 初期配置30～35マス
3. **難しい（Hard）**: 初期配置25～30マス
4. **超難問（Expert）**: 初期配置20～25マス

---

## 3. 画面設計

### 3.1 ゲーム開始画面
#### 表示要素
- ゲームタイトル「数独」
- 難易度選択ボタン（簡単・普通・難しい・超難問）
- ゲームルール説明セクション
- 過去の記録表示（難易度別ベストタイム）
- 言語切替ボタン

#### レイアウト
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│          🔢 数独                │
│                                 │
│      難易度を選択してください      │
│                                 │
│    [簡単]  [普通]               │
│    [難しい] [超難問]             │
│                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━      │
│  📊 ベストタイム                 │
│  簡単: 7:32                     │
│  普通: 15:48                    │
│  難しい: 28:15                   │
│  超難問: --:--                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                 │
│  ℹ️ ゲームルール                │
│  ・9×9のグリッドを埋める          │
│  ・各行に1～9を配置              │
│  ・各列に1～9を配置              │
│  ・各3×3ブロックに1～9を配置     │
│                                 │
└─────────────────────────────────┘
```

### 3.2 ゲームプレイ画面
#### 表示要素
- 9×9の数独グリッド
- 数字入力パネル（1～9、メモ、消去）
- タイマー表示
- 難易度表示
- ヒントボタン（残り回数表示）
- やり直しボタン
- 新しいゲームボタン
- 一時停止ボタン
- エラーハイライト表示

#### レイアウト
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│  難易度: 普通    ⏱️ 12:34       │
│  ヒント残り: 3   [一時停止]      │
│                                 │
│  ┏━━━┯━━━┯━━━┳━━━┯━━━┯━━━┓      │
│  ┃ 5 │   │ 3 ┃ 7 │   │ 2 ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃   │ 7 │   ┃   │ 5 │   ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃ 2 │   │   ┃   │   │ 8 ┃      │
│  ┣━━━┿━━━┿━━━╋━━━┿━━━┿━━━┫      │
│  ┃ 9 │   │ 7 ┃   │ 3 │   ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃   │ 4 │   ┃ 2 │   │ 6 ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃   │ 3 │   ┃ 9 │   │   ┃      │
│  ┣━━━┿━━━┿━━━╋━━━┿━━━┿━━━┫      │
│  ┃ 7 │   │   ┃   │   │ 3 ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃   │ 9 │   ┃   │ 2 │   ┃      │
│  ┃───┼───┼───╂───┼───┼───┃      │
│  ┃ 4 │   │ 5 ┃ 8 │   │ 7 ┃      │
│  ┗━━━┷━━━┷━━━┻━━━┷━━━┷━━━┛      │
│                                 │
│  数字入力                        │
│  [1][2][3][4][5][6][7][8][9]    │
│  [✏️メモ] [🗑️消去] [💡ヒント]   │
│                                 │
│  [↶ やり直し] [🔄 新しいゲーム]  │
│                                 │
└─────────────────────────────────┘
```

### 3.3 ゲーム完了画面
#### 表示要素
- 完了メッセージ
- クリアタイム
- ベストタイム更新通知（該当時）
- 統計情報（ヒント使用回数、やり直し回数）
- もう一度プレイボタン
- 難易度選択に戻るボタン
- SNSシェアボタン

---

## 4. 機能要件

### 4.1 パズル生成機能
- **完全な解を持つパズルの生成**: バックトラッキングアルゴリズム
- **難易度別の初期配置数調整**
- **一意解の保証**: 解が複数存在しない
- **対称配置**: 見た目の美しさを考慮（オプション）

### 4.2 入力機能
#### 数字入力
- マス選択 → 数字ボタンで入力
- キーボード入力対応（1～9キー）
- 選択中のマスをハイライト表示

#### メモ機能
- メモモードのON/OFF切替
- 1つのマスに複数の候補数字を小さく表示
- 通常入力時にメモを自動クリア

#### 消去機能
- 選択中のマスの数字/メモを削除
- Backspace/Deleteキーで削除

### 4.3 ヒント機能
- 選択中のマスの正解を表示
- 難易度別の使用可能回数:
  - 簡単: 5回
  - 普通: 3回
  - 難しい: 2回
  - 超難問: 1回
- 使用回数の表示
- 使用後は取り消し不可

### 4.4 やり直し（Undo）機能
- 最大30手前まで戻れる
- 履歴スタックで管理
- ヒントで入力した数字も取り消し可能

### 4.5 エラーチェック機能
#### リアルタイムチェック
- 同じ行に同じ数字がある
- 同じ列に同じ数字がある
- 同じ3×3ブロックに同じ数字がある

#### エラー表示
- エラーのあるマスを赤色でハイライト
- エラー数をカウント表示（オプション）

### 4.6 自動チェック機能
- **オートチェックモード**: 入力時に自動でエラー判定
- **完了時チェック**: すべて埋まった時に正誤判定
- **エラー許容設定**: エラーを許すか即座に赤表示するか選択可能

### 4.7 タイマー機能
- ゲーム開始時にタイマースタート
- 一時停止対応
- MM:SS形式で表示
- ベストタイム記録（難易度別）

### 4.8 保存・再開機能
- プレイ途中のゲームをローカルストレージに保存
- ページを離れても続きから再開可能
- 複数の進行中ゲームを保存（難易度別）

### 4.9 統計機能
- プレイ回数（難易度別）
- クリア回数（難易度別）
- 平均クリアタイム
- ベストタイム（難易度別）
- ヒント使用率

---

## 5. 技術仕様

### 5.1 使用技術
- **HTML5**: ゲーム画面構築
- **CSS3**: スタイリング、アニメーション
- **JavaScript (ES6+)**: ゲームロジック実装

### 5.2 データ構造
#### パズルデータ
```javascript
{
  grid: Array(9).fill(null).map(() => Array(9).fill(0)), // 9×9配列
  solution: Array(9).fill(null).map(() => Array(9).fill(0)), // 解答
  initial: Array(9).fill(null).map(() => Array(9).fill(false)), // 固定マス
  difficulty: 'normal', // 難易度
  startTime: timestamp,
  elapsedTime: 0,
  hintsUsed: 0,
  hintsRemaining: 3
}
```

#### メモデータ
```javascript
{
  notes: Array(9).fill(null).map(() => 
    Array(9).fill(null).map(() => new Set())
  ) // 各マスの候補数字
}
```

### 5.3 主要アルゴリズム
#### パズル生成
1. 完全な9×9グリッドを生成（バックトラッキング）
2. ランダムにマスを削除
3. 一意解をチェック
4. 難易度に応じた削除数に調整

#### 解答チェック
1. 各行の重複チェック
2. 各列の重複チェック
3. 各3×3ブロックの重複チェック

#### ヒント生成
1. 空のマスから1つランダム選択
2. 解答データから正解の数字を取得
3. マスに数字を配置

### 5.4 ローカルストレージ
```javascript
localStorage.setItem('sudoku_current', JSON.stringify(gameData));
localStorage.setItem('sudoku_stats', JSON.stringify(statistics));
localStorage.setItem('sudoku_bestTimes', JSON.stringify(bestTimes));
```

---

## 6. UI/UXデザイン

### 6.1 カラースキーム
- **背景**: グラデーション（紫系）
- **ゲームボード**: 白背景
- **グリッド線**: 
  - 3×3ブロック境界: 太い黒線（2px）
  - セル境界: 細いグレー線（1px）
- **固定数字**: 黒（太字）
- **入力数字**: 青
- **選択中マス**: 薄い青背景
- **同じ数字ハイライト**: 薄い黄色背景
- **エラー**: 赤背景、赤文字
- **メモ**: 小さいグレー文字

### 6.2 アニメーション
- 数字入力時のフェードイン
- エラー時の振動アニメーション
- 完了時の花火エフェクト
- ボタンホバー時のスケール変化

### 6.3 レスポンシブデザイン
- **デスクトップ（1200px以上）**: グリッド600px × 600px
- **タブレット（768px～1199px）**: グリッド500px × 500px
- **スマートフォン（767px以下）**: グリッド90vw（画面幅の90%）
- タッチ操作最適化
- 数字パネルをスワイプ対応

### 6.4 アクセシビリティ
- キーボード操作完全対応
  - 矢印キーでマス移動
  - 数字キーで入力
  - Tabキーでフォーカス移動
- スクリーンリーダー対応
- 高コントラストモード対応

---

## 7. 多言語対応

### 7.1 対応言語
- 日本語
- 英語
- 中国語（簡体字）
- ヒンディー語
- スペイン語
- フランス語

### 7.2 翻訳項目
```javascript
{
  "sudoku": {
    "title": "数独",
    "difficulty": {
      "easy": "簡単",
      "normal": "普通",
      "hard": "難しい",
      "expert": "超難問"
    },
    "controls": {
      "hint": "ヒント",
      "undo": "やり直し",
      "erase": "消去",
      "notes": "メモ",
      "pause": "一時停止",
      "newGame": "新しいゲーム"
    },
    "messages": {
      "complete": "おめでとうございます！パズルを完成させました！",
      "newRecord": "新記録達成！",
      "error": "エラーがあります",
      "hintsRemaining": "ヒント残り: {count}回"
    },
    "stats": {
      "time": "タイム",
      "bestTime": "ベストタイム",
      "hintsUsed": "ヒント使用",
      "mistakes": "ミス"
    }
  }
}
```

---

## 8. パフォーマンス要件

### 8.1 レスポンス時間
- パズル生成: 2秒以内
- 数字入力の反映: 100ms以内
- エラーチェック: 50ms以内
- ヒント表示: 200ms以内

### 8.2 メモリ使用量
- ゲームデータ: 50KB以内
- 履歴データ: 20KB以内

---

## 9. テスト要件

### 9.1 機能テスト
- [ ] パズル生成の一意解チェック
- [ ] 全難易度レベルでの動作確認
- [ ] 数字入力の正確性
- [ ] メモ機能の動作
- [ ] ヒント機能の回数制限
- [ ] やり直し機能の履歴管理
- [ ] エラーチェックの精度
- [ ] タイマーの正確性
- [ ] 保存・再開機能

### 9.2 UI/UXテスト
- [ ] 全画面サイズでの表示確認
- [ ] タッチ操作の快適性
- [ ] キーボード操作の完全性
- [ ] アニメーションの滑らかさ

### 9.3 ブラウザ互換性
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)
- [ ] モバイルブラウザ

---

## 10. 今後の拡張予定

### 10.1 追加機能
- **デイリーチャレンジ**: 毎日異なる問題
- **ランキング機能**: 世界中のプレイヤーと競争
- **問題共有**: 自分で作った問題をシェア
- **テーマ変更**: カラースキームのカスタマイズ
- **サウンドエフェクト**: 入力音、完了音
- **アチーブメント**: 実績・トロフィー機能

### 10.2 難易度追加
- **子供向け**: 4×4、6×6グリッド
- **変則ルール**: 不等号数独、対角線数独

---

## 11. 参考資料

### 11.1 数独のルールと戦略
- 基本ルール
- 解き方のテクニック（隠れた単一候補、ボックスライン削除など）

### 11.2 デザイン参考
- シンプルで見やすいグリッドデザイン
- 直感的な操作インターフェース
- 疲れにくい色使い

---

## 12. 承認・レビュー

### 12.1 レビュー者
- プロジェクトマネージャー: __________
- デザイナー: __________
- 開発者: __________

### 12.2 承認日
承認日: ____年____月____日

---

**文書バージョン**: 1.0  
**最終更新日**: 2025年11月27日  
**作成者**: Game Portal Development Team
