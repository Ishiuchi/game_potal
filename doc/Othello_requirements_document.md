# 実装仕様書（オセロ）


## 変更履歴
プログラムを修正するごとに本仕様書の変更履歴も更新してください
| バージョン | 日付 | 変更内容 |
|:---:|:---|:---|
| v1.0 | 2025/11/22 | 初版作成 |
| v2.0 | 2025/11/22 | 完全実装（8×8盤面、PvP/CPU、合法手判定、裏返し処理） |
| v2.1 | 2025/11/22 | バグ修正（合法手表示のタイミング最適化） |
| v2.2 | 2025/11/22 | UI改善（遊び方・ルールセクション追加） |
| v2.3 | 2025/11/22 | UX改善（CPU思考時間、思考中メッセージ表示） |

### 文書の目的
本仕様書は、Webポータル「GAME PORTAL」に実装する「オセロ（リバーシ）」ゲームの要件を定義する。8×8盤面での対戦型ボードゲームとして、プレイヤー対戦とCPU対戦の両モードを実装する。

## 1. プロジェクト概要

### 1.1 ゲームコンセプト
- **ジャンル**: 戦略ボードゲーム
- **目的**: 相手の石を挟んで裏返し、最終的に自分の色の石を多くする
- **特徴**:
  - 8×8の盤面
  - 8方向の挟み判定
  - パス処理自動化
  - 3段階のCPU難易度

### 1.2 技術要件
- **使用言語**: HTML5, CSS3, JavaScript (ES6+)
- **フレームワーク**: なし（Vanilla JS）
- **ブラウザ要件**: モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版）
- **レスポンシブ対応**: PC・タブレット・スマートフォン

## 2. ゲーム仕様


## 基本要件
- ブラウザで動作する 8×8 オセロゲームを作成する
- 使用技術：HTML、CSS、JavaScript（フレームワークなし）
- プレイヤーは「黒 → 白 → 黒 → 白…」の交互ターン
- 盤面クリックで石を置く
- 裏返しルールを 8方向すべて正しく実装する
- 合法手がない場合はパスとしてターンを自動的にスキップ
- 両者がパスしたらゲーム終了
- ゲーム終了時、黒石・白石を集計し勝敗を表示する
- CPU対戦も実装して、レベルを3段階で選択させる
    - レベル1：ランダム合法手
    - レベル2：最大裏返し数を選択
    - レベル3：簡易評価関数による最適手
- オンライン対戦とフレンド対戦の拡張性を持たせる


## UI 要件
- 8×8 の盤面グリッドを表示する
- 石は CSS の円スタイルで描画（黒石・白石）
- 画面上に「黒の番」「白の番」など現在ターンを表示
- リアルタイムスコア表示（黒石・白石の現在数）
- 合法手のハイライト表示（現在のプレイヤーが置ける場所を視覚的に表示）
- ゲームモード選択画面
    - プレイヤー vs プレイヤー
    - プレイヤー vs CPU（レベル選択可能）
    - 遊び方・ルールセクション（初心者向けガイド）
- ゲーム終了時のモーダル表示（勝敗結果と最終スコア）
- スマホでも最低限操作できるレスポンシブデザイン
    - タップで石を置ける
    - モバイルでも見やすいレイアウト


## ロジック要件
### 石を置く処理
- クリックされたマスが合法手かどうかを判定する
- 合法手であれば、8方向の探索を行い、挟んだ石を裏返す
- 石を置いた後、ターンを交代する
- ターン交代後に盤面を再描画し、次のプレイヤーの合法手を表示する

### 合法手判定
- 隣が相手の石かどうか
- その先に相手の石が連続しているか
- さらにその先に自分の石があるか
- 上記条件を満たす方向が一つでもあれば合法手
- 現在のプレイヤーの合法手のみを表示する

### パス処理
- 合法手が 0 の場合は「パス」としてターンを相手へ渡す
- 両者連続でパスした場合はゲーム終了
- パス時はコンソールにログ出力

### 勝敗判定
- 黒石と白石の個数を数え、勝敗を表示する
- モーダルで結果を表示（勝者、最終スコア）

### CPU対戦ロジック
- レベル1：ランダムに合法手から選択
- レベル2：最も多くの石を裏返せる手を選択
- レベル3：評価関数を使用（角の位置に高い重みを設定）
- CPUの手は0.5秒の遅延後に実行（視覚的な配慮）


## デバッグ要件（任意）
- console.log で内部の盤面データを確認できるようにする
- getLegalMoves() や flipStones() の動作にコメントを追加する
- 初期化時とゲーム終了時にログ出力
- パス発生時にログ出力


## コード品質要件
- 可読性優先の変数名・関数名を使用する
- グローバル変数は必要最小限にする（ゲーム状態管理のみ）
- 重要処理に説明コメントを記述する
- マジックナンバーを避ける（定数として定義：BOARD_SIZE, EMPTY, BLACK, WHITE等）
- 合法手判定や裏返し処理などは関数として分離し、再利用可能にする
- 8方向の探索はDIRECTIONS配列を使用して統一的に処理
- 各関数は単一責任の原則に従う


## 実装済みファイル構成
```
src/
├── othello.html      # メインHTML（ゲーム画面、モード選択、モーダル）
├── othello.css       # オセロ専用スタイル
├── othello.js        # ゲームロジック実装
├── game-page.css     # 共通ゲームページスタイル
├── index.html        # トップページ
├── ludo.html         # ルドーゲームページ
└── styles.css        # トップページスタイル
```


## 主要関数一覧
- `initBoard()` - 盤面初期化
- `startGame(mode)` - ゲーム開始
- `renderBoard()` - 盤面描画
- `handleCellClick(row, col)` - セルクリック処理
- `makeMove(row, col, player)` - 手を打つ
- `isLegalMove(row, col, player)` - 合法手判定
- `flipStones(row, col, player)` - 石を裏返す
- `getLegalMoves(player)` - 全ての合法手を取得
- `switchTurn()` - ターン交代
- `cpuMove()` - CPU の手
- `updateStatus()` - ステータス更新
- `countStones()` - 石の数をカウント
- `endGame()` - ゲーム終了処理
- `resetGame()` - ゲームリセット