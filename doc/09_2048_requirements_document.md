# 2048ゲーム 要件定義書

## 1. ゲーム概要

### 1.1 ゲーム名
2048（にーぜろよんはち）

### 1.2 ゲームの説明
4×4のグリッド上でタイルをスライドさせ、同じ数字のタイルを合体させて2048のタイルを作ることを目指すパズルゲーム。矢印キーまたはスワイプでタイルを上下左右に動かし、同じ数字同士が接触すると合体して倍の数字になります。シンプルなルールながら戦略性が高く、世界中で人気のパズルゲームです。

### 1.3 ゲームの目的
- 2048のタイルを作成する（基本目標）
- さらに高い数字（4096、8192...）を目指す
- 最高スコアを更新する
- 論理的思考力と先読み能力を鍛える

### 1.4 プレイ人数
1人

### 1.5 想定プレイ時間
- 1ゲーム: 3～15分
- 2048達成: 10～20分
- ハイスコア狙い: 15分～

---

## 2. ゲームルール

### 2.1 基本ルール
1. **グリッド構成**: 4×4のマス（16マス）
2. **初期状態**: ゲーム開始時にランダムな位置に2つのタイル（2または4）が配置される
3. **タイル移動**: 矢印キー（上下左右）でタイルをスライド
4. **タイル合体**:
   - 同じ数字のタイル2つが接触すると合体
   - 合体後は2倍の数字になる（2+2=4, 4+4=8, 8+8=16...）
   - 1回の移動で同じタイルは1回しか合体しない
5. **新しいタイル**: 移動するたびにランダムな空きマスに新しいタイル（2または4）が出現
6. **新タイルの確率**: 90%で2、10%で4

### 2.2 操作方法
#### キーボード操作（デスクトップ）
- **↑（上矢印）**: タイルを上に移動
- **↓（下矢印）**: タイルを下に移動
- **←（左矢印）**: タイルを左に移動
- **→（右矢印）**: タイルを右に移動
- **W/A/S/D**: 代替キー（W=上、A=左、S=下、D=右）

#### タッチ操作（モバイル）
- **スワイプ上**: タイルを上に移動
- **スワイプ下**: タイルを下に移動
- **スワイプ左**: タイルを左に移動
- **スワイプ右**: タイルを右に移動

#### マウス操作
- グリッドをドラッグして方向指定（オプション）

### 2.3 タイル移動の詳細ルール
1. **スライド**: 指定された方向にタイルがスライドし、端または他のタイルに当たるまで移動
2. **合体の優先順位**: 移動方向の先頭から順に合体処理
3. **1ターン1合体**: 合体したタイルは同じターン内で再合体しない
4. **例（右方向の移動）**:
   ```
   [2][2][4][4] → [空][空][4][8]
   [2][4][2][空] → [空][2][4][2]
   [2][2][2][2] → [空][空][4][4]
   ```

### 2.4 スコア計算
- **基本**: 合体したタイルの数値がスコアに加算
  - 2+2=4の合体 → +4点
  - 4+4=8の合体 → +8点
  - 8+8=16の合体 → +16点
- **スコアの蓄積**: ゲーム中のすべての合体スコアが累積される

### 2.5 勝利条件
- **基本目標**: 2048のタイルを作成
- **継続プレイ**: 2048達成後も続けてより高い数字を目指せる

### 2.6 敗北条件
- グリッドが埋まり、どの方向にも移動・合体ができなくなった状態（ゲームオーバー）

### 2.7 難易度設定
#### クラシック（4×4）
- 標準的な難易度
- 2048達成が目標

#### イージー（5×5）
- グリッドサイズ: 5×5（25マス）
- より多くのスペースで遊びやすい
- 初心者向け

#### ハード（3×3）
- グリッドサイズ: 3×3（9マス）
- 限られたスペースで高難易度
- 上級者向け

---

## 3. 画面設計

### 3.1 ゲーム開始画面
#### 表示要素
- ゲームタイトル「2048」
- グリッドサイズ選択（3×3 / 4×4 / 5×5）
- ゲーム開始ボタン
- ゲームルール説明セクション
- ベストスコア表示
- 設定ボタン（アニメーション速度など）
- 言語切替ボタン

#### レイアウト
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│         🎮 2048                 │
│                                 │
│     グリッドサイズを選択          │
│                                 │
│    [3×3]  [4×4]  [5×5]         │
│   ハード クラシック イージー      │
│                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━      │
│  🏆 ベストスコア                 │
│  3×3: 2,048                     │
│  4×4: 12,345                    │
│  5×5: 8,976                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                 │
│  ℹ️ ゲームルール                │
│  ・矢印キーでタイルを移動         │
│  ・同じ数字を合体させる           │
│  ・2048を目指そう！              │
│                                 │
│      [ゲーム開始]                │
│                                 │
└─────────────────────────────────┘
```

### 3.2 ゲームプレイ画面
#### 表示要素
- 4×4グリッド（タイル配置エリア）
- スコア表示（現在のスコア）
- ベストスコア表示
- 新しいゲームボタン
- やり直しボタン（Undo - 1手戻す）
- ヒントボタン（次の最善手を提案）
- 設定ボタン

#### レイアウト（4×4）
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│  スコア: 1,234  ベスト: 12,345  │
│  [🔄 新規] [↶ やり直し] [💡]    │
│                                 │
│  ┌─────┬─────┬─────┬─────┐    │
│  │     │  2  │     │  4  │    │
│  ├─────┼─────┼─────┼─────┤    │
│  │  8  │ 16  │  2  │     │    │
│  ├─────┼─────┼─────┼─────┤    │
│  │  2  │  4  │  8  │ 16  │    │
│  ├─────┼─────┼─────┼─────┤    │
│  │ 32  │ 64  │128  │256  │    │
│  └─────┴─────┴─────┴─────┘    │
│                                 │
│  操作: ← ↑ → ↓ または スワイプ  │
│                                 │
│  移動回数: 45                    │
│  最大タイル: 256                 │
│                                 │
└─────────────────────────────────┘
```

### 3.3 ゲーム完了画面（2048達成時）
#### 表示要素
- 達成おめでとうメッセージ
- 最終スコア
- 移動回数
- 達成タイム
- 継続プレイボタン（Keep Going）
- 新しいゲームボタン
- SNSシェアボタン

### 3.4 ゲームオーバー画面
#### 表示要素
- ゲームオーバーメッセージ
- 最終スコア
- 最大タイル
- 移動回数
- もう一度プレイボタン
- メニューに戻るボタン

---

## 4. 機能要件

### 4.1 グリッド生成機能
- 4×4の空グリッドを作成
- 初期タイル2つをランダム配置（2または4）
- グリッドサイズの変更対応（3×3、5×5）

### 4.2 タイル移動機能
#### 移動処理アルゴリズム
1. **スライド**: 指定方向に全タイルを移動
2. **合体判定**: 隣接する同じ数字のタイルを検出
3. **合体実行**: 2つのタイルを1つに統合（値を2倍に）
4. **スコア加算**: 合体後の値をスコアに追加
5. **新タイル生成**: 空きマスにランダムで2または4を配置

#### 移動可能判定
- 指定方向に移動できるタイルがあるか
- 合体可能な組み合わせがあるか
- 移動不可の場合は何も起こらない

### 4.3 合体処理機能
#### 合体ルール
- 同じ数字のタイル2つが接触 → 合体
- 合体後のタイル値 = 元の値 × 2
- 1回の移動で同じタイルは1回のみ合体
- 合体は移動方向の先頭から順に処理

#### 合体例
```
左方向移動の例:
┌───┬───┬───┬───┐       ┌───┬───┬───┬───┐
│ 2 │ 2 │ 4 │   │  →   │ 4 │ 4 │   │   │
└───┴───┴───┴───┘       └───┴───┴───┴───┘

┌───┬───┬───┬───┐       ┌───┬───┬───┬───┐
│ 2 │ 2 │ 2 │ 2 │  →   │ 4 │ 4 │   │   │
└───┴───┴───┴───┘       └───┴───┴───┴───┘
（左から順に2つずつ合体）
```

### 4.4 新タイル生成機能
- 空きマスのリストを取得
- ランダムに1マスを選択
- 90%の確率で2、10%の確率で4を配置
- アニメーションでタイルが出現

### 4.5 ゲームオーバー判定機能
#### 判定条件
1. グリッドが完全に埋まっている
2. 上下左右どの方向にも移動・合体ができない

#### 判定アルゴリズム
```javascript
function isGameOver() {
  // 空きマスがあればゲーム継続
  if (hasEmptyCell()) return false;
  
  // 全方向で移動可能性をチェック
  for (direction of [UP, DOWN, LEFT, RIGHT]) {
    if (canMove(direction)) return false;
  }
  
  return true; // 移動不可 = ゲームオーバー
}
```

### 4.6 スコア管理機能
- 現在のスコアを表示
- ベストスコアを記録・表示
- スコア加算アニメーション
- ローカルストレージに保存

### 4.7 やり直し（Undo）機能
- 直前の1手を取り消す
- 最大5手前まで記録
- グリッド状態とスコアを復元
- 使用回数制限（オプション）

### 4.8 ヒント機能
- 次の最善手を提案
- 矢印でおすすめの方向を表示
- 使用回数制限（3回まで）
- 戦略アルゴリズム:
  1. 最大タイルを特定の隅に維持
  2. 大きい数字を端に配置
  3. 合体可能なタイルの組み合わせを優先

### 4.9 オートプレイ機能（デモモード）
- AIが自動でプレイ
- 戦略アルゴリズムに基づいた移動
- 一時停止・再開可能
- 学習・観察用

### 4.10 統計機能
- 総プレイ回数
- 2048達成回数
- 平均スコア
- 最大タイル記録
- 平均移動回数

---

## 5. 技術仕様

### 5.1 使用技術
- **HTML5**: ゲーム画面構築
- **CSS3**: スタイリング、アニメーション、グラデーション
- **JavaScript (ES6+)**: ゲームロジック実装

### 5.2 データ構造
#### グリッド状態
```javascript
{
  grid: [
    [0, 2, 0, 4],
    [8, 16, 2, 0],
    [2, 4, 8, 16],
    [32, 64, 128, 256]
  ],
  score: 1234,
  bestScore: 12345,
  moveCount: 45,
  maxTile: 256,
  gameOver: false,
  won: false,
  keepPlaying: false
}
```

#### 履歴スタック（Undo用）
```javascript
{
  history: [
    {
      grid: [...],
      score: 1000,
      moveCount: 40
    },
    // ... 最大5件
  ]
}
```

### 5.3 主要アルゴリズム
#### タイル移動（左方向の例）
```javascript
function moveLeft(grid) {
  const newGrid = createEmptyGrid();
  let scoreGain = 0;
  
  for (let row = 0; row < 4; row++) {
    const tiles = grid[row].filter(val => val !== 0);
    const merged = [];
    
    for (let i = 0; i < tiles.length; i++) {
      if (tiles[i] === tiles[i + 1]) {
        merged.push(tiles[i] * 2);
        scoreGain += tiles[i] * 2;
        i++; // 次のタイルをスキップ
      } else {
        merged.push(tiles[i]);
      }
    }
    
    // 左詰めで配置
    for (let col = 0; col < merged.length; col++) {
      newGrid[row][col] = merged[col];
    }
  }
  
  return { newGrid, scoreGain };
}
```

#### ゲームオーバー判定
```javascript
function checkGameOver(grid) {
  // 空きマスチェック
  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 4; col++) {
      if (grid[row][col] === 0) return false;
    }
  }
  
  // 隣接タイル合体可能性チェック
  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 4; col++) {
      const current = grid[row][col];
      
      // 右隣チェック
      if (col < 3 && grid[row][col + 1] === current) return false;
      
      // 下隣チェック
      if (row < 3 && grid[row + 1][col] === current) return false;
    }
  }
  
  return true; // ゲームオーバー
}
```

### 5.4 ローカルストレージ
```javascript
localStorage.setItem('2048_bestScore_4x4', JSON.stringify(12345));
localStorage.setItem('2048_stats', JSON.stringify({
  gamesPlayed: 100,
  gamesWon: 15,
  totalScore: 500000,
  maxTile: 4096
}));
```

---

## 6. UI/UXデザイン

### 6.1 カラースキーム
#### グリッド
- **背景**: #bbada0（ベージュグレー）
- **空セル**: #cdc1b4（薄いベージュ）

#### タイルの色（値に応じて変化）
- **2**: #eee4da（薄いベージュ）、文字: #776e65
- **4**: #ede0c8（ベージュ）、文字: #776e65
- **8**: #f2b179（オレンジ）、文字: #f9f6f2
- **16**: #f59563（濃いオレンジ）、文字: #f9f6f2
- **32**: #f67c5f（赤オレンジ）、文字: #f9f6f2
- **64**: #f65e3b（赤）、文字: #f9f6f2
- **128**: #edcf72（黄色）、文字: #f9f6f2
- **256**: #edcc61（濃い黄色）、文字: #f9f6f2
- **512**: #edc850（金色）、文字: #f9f6f2
- **1024**: #edc53f（濃い金色）、文字: #f9f6f2
- **2048**: #edc22e（ゴールド）、文字: #f9f6f2
- **4096以上**: #3c3a32（黒）、文字: #f9f6f2

### 6.2 タイルデザイン
- **サイズ**: 動的（グリッドサイズに応じて調整）
- **角丸**: 8px
- **フォント**: 太字、中央揃え
- **フォントサイズ**: タイルの値に応じて調整
  - 2～64: 55px
  - 128～512: 45px
  - 1024～2048: 35px
  - 4096以上: 30px

### 6.3 アニメーション
#### タイル出現
- スケールアニメーション（0 → 1）
- 0.2秒のイージング

#### タイル移動
- スムーズなスライド（0.1～0.15秒）
- 移動距離に応じた速度調整

#### タイル合体
- パルス効果（少し大きくなってから元に戻る）
- 0.2秒のアニメーション

#### スコア加算
- 数字がカウントアップ
- フェードイン効果

### 6.4 レスポンシブデザイン
#### デスクトップ（1200px以上）
- グリッドサイズ: 500px × 500px
- タイルサイズ: 110px × 110px（4×4の場合）

#### タブレット（768px～1199px）
- グリッドサイズ: 400px × 400px
- タイルサイズ: 90px × 90px

#### スマートフォン（767px以下）
- グリッドサイズ: 90vw
- タイルサイズ: 動的計算
- スワイプ操作最適化

### 6.5 タッチジェスチャー
- **最小スワイプ距離**: 30px
- **スワイプ検出**: touchstart → touchmove → touchend
- **速度閾値**: 高速スワイプの検出
- **誤操作防止**: 最小移動距離の設定

---

## 7. 多言語対応

### 7.1 対応言語
- 日本語
- 英語
- 中国語（簡体字）
- ヒンディー語
- スペイン語
- フランス語

### 7.2 翻訳項目
```javascript
{
  "2048": {
    "title": "2048",
    "subtitle": "数字を合体させて2048を目指そう！",
    "gridSize": {
      "3x3": "3×3（ハード）",
      "4x4": "4×4（クラシック）",
      "5x5": "5×5（イージー）"
    },
    "controls": {
      "newGame": "新しいゲーム",
      "undo": "やり直し",
      "hint": "ヒント",
      "settings": "設定"
    },
    "stats": {
      "score": "スコア",
      "bestScore": "ベストスコア",
      "moves": "移動回数",
      "maxTile": "最大タイル"
    },
    "messages": {
      "win": "おめでとうございます！2048達成！",
      "keepPlaying": "続ける",
      "gameOver": "ゲームオーバー",
      "tryAgain": "もう一度",
      "newRecord": "新記録達成！",
      "noUndo": "やり直しできません",
      "noHints": "ヒントを使い切りました"
    },
    "instructions": {
      "title": "遊び方",
      "move": "矢印キーまたはスワイプでタイルを移動",
      "merge": "同じ数字のタイルを合体させる",
      "goal": "2048を作ることが目標",
      "keyboard": "キーボード: ← ↑ → ↓",
      "touch": "タッチ: スワイプで移動"
    },
    "settings": {
      "animationSpeed": "アニメーション速度",
      "fast": "速い",
      "normal": "普通",
      "slow": "遅い",
      "sound": "サウンド",
      "vibration": "バイブレーション"
    }
  }
}
```

---

## 8. パフォーマンス要件

### 8.1 レスポンス時間
- タイル移動の反映: 150ms以内
- 合体アニメーション: 200ms以内
- 新タイル生成: 100ms以内
- ゲームオーバー判定: 50ms以内

### 8.2 アニメーション
- 60fps維持
- スムーズなトランジション
- メモリリークなし

### 8.3 メモリ使用量
- ゲームデータ: 10KB以内
- 履歴スタック: 5KB以内

---

## 9. テスト要件

### 9.1 機能テスト
- [ ] タイル移動の正確性（全4方向）
- [ ] タイル合体ロジックの正確性
- [ ] スコア計算の正確性
- [ ] ゲームオーバー判定の正確性
- [ ] 2048達成判定
- [ ] 新タイル生成の確率（2:90%, 4:10%）
- [ ] やり直し機能の動作
- [ ] ヒント機能の精度
- [ ] ベストスコアの保存・読み込み

### 9.2 UI/UXテスト
- [ ] 全画面サイズでの表示確認
- [ ] キーボード操作の快適性
- [ ] スワイプ操作の快適性
- [ ] アニメーションの滑らかさ
- [ ] 色覚障害者への配慮（数字表示）

### 9.3 エッジケーステスト
- [ ] グリッド満杯時の動作
- [ ] 連続合体の処理
- [ ] 3つ以上の同じ数字が並んだ場合
- [ ] 高速連続操作時の動作

### 9.4 ブラウザ互換性
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)
- [ ] iOS Safari
- [ ] Android Chrome

---

## 10. 今後の拡張予定

### 10.1 追加機能
- **デイリーチャレンジ**: 毎日同じ初期配置で競争
- **タイムアタック**: 制限時間内に2048を目指す
- **ステップ制限**: 指定回数以内でクリア
- **マルチプレイ**: 同時プレイで高スコア競争
- **カスタムグリッド**: 6×6、8×8などの大きいサイズ
- **テーマ変更**: ダークモード、カラフルテーマ

### 10.2 ゲームモード追加
#### サバイバルモード
- タイルが一定時間ごとに追加される
- 長く生き残ることが目標

#### リバースモード
- 2048から逆算して2を目指す
- 逆の思考が必要

#### 障害物モード
- 一部のマスが固定されている
- より戦略的な移動が必要

### 10.3 アチーブメント
- 「初クリア」: 初めて2048達成
- 「スピードラン」: 100手以内に2048達成
- 「パーフェクト」: やり直しなしでクリア
- 「マスター」: 4096達成
- 「レジェンド」: 8192達成

---

## 11. サウンド効果

### 11.1 効果音
- **タイル移動**: スライド音（シュッ）
- **タイル合体**: ポップ音（ピコッ）
- **2048達成**: ファンファーレ
- **ゲームオーバー**: 低い音
- **新記録**: 拍手・歓声

### 11.2 音量設定
- マスター音量: 0～100%
- ミュートボタン
- 効果音のON/OFF個別設定

---

## 12. 戦略ガイド（ヒント）

### 12.1 基本戦略
1. **隅固定**: 最大タイルを特定の隅（通常は右下）に固定
2. **蛇行配置**: 大きい数字を端に沿って配置
3. **空きマス確保**: 常に移動の余地を残す
4. **計画的合体**: 次の手を常に考える

### 12.2 上級テクニック
- 連鎖合体を狙う
- 2方向のみを使う（例: 下と右のみ）
- 大きい数字を一箇所に集める
- 小さい数字の配置を最適化

---

## 13. アクセシビリティ

### 13.1 対応機能
- キーボード完全操作
- スクリーンリーダー対応
- 高コントラストモード
- 色覚障害者対応（数字表示）
- 文字サイズ調整

### 13.2 ARIA属性
```html
<div role="grid" aria-label="2048ゲームグリッド">
  <div role="row">
    <div role="gridcell" aria-label="タイル 2">2</div>
  </div>
</div>
```

---

## 14. 承認・レビュー

### 14.1 レビュー者
- プロジェクトマネージャー: __________
- デザイナー: __________
- 開発者: __________

### 14.2 承認日
承認日: ____年____月____日

---

**文書バージョン**: 1.0  
**最終更新日**: 2025年11月27日  
**作成者**: Game Portal Development Team
