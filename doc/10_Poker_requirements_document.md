# ポーカーゲーム 要件定義書

## 1. ゲーム概要

### 1.1 ゲーム名
ポーカー（Poker）

### 1.2 ゲームの説明
5枚のカードで役を作り、相手と勝負するカードゲーム。配られた5枚のカードから好きな枚数を交換（ドロー）して、より強い役を作ります。シンプルながら運と戦略性を兼ね備えた、世界中で愛されるカードゲームです。ドローポーカー（ファイブカードドロー）を実装します。

### 1.3 ゲームの目的
- より強い役を作って相手に勝つ
- チップを増やしてハイスコアを目指す
- 役の強さを覚え、戦略的な判断力を養う
- ベット・レイズ・フォールドの駆け引きを楽しむ

### 1.4 プレイ人数
- 1人（CPU対戦）
- 対戦相手: 1～3人のCPU

### 1.5 想定プレイ時間
- 1ゲーム（1ハンド）: 1～3分
- セッション: 10～30分

---

## 2. ゲームルール

### 2.1 基本ルール（ファイブカードドロー）
1. **参加者**: プレイヤー + CPU 1～3人（計2～4人）
2. **初期チップ**: 各プレイヤー1,000チップ
3. **アンティ**: ゲーム参加料（例: 10チップ）を全員が支払う
4. **配布**: 各プレイヤーに5枚のカードが配られる
5. **第1ベッティングラウンド**: 
   - チェック、ベット、コール、レイズ、フォールドを選択
6. **ドロー**: 
   - 0～5枚のカードを交換できる
   - 交換しない選択も可能（スタンド）
7. **第2ベッティングラウンド**: 
   - 再度、チェック、ベット、コール、レイズ、フォールド
8. **ショーダウン**: 
   - 残ったプレイヤーが手札を公開
   - 最も強い役を持つプレイヤーが勝利
9. **ポット獲得**: 勝者がポット（賭けられたチップの総額）を獲得

### 2.2 カード構成
- **デッキ**: 52枚（ジョーカーなし）
- **スート（絵柄）**: スペード♠、ハート♥、ダイヤ♦、クラブ♣
- **ランク（数字）**: 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A
- **強さ順**: 2 < 3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < J < Q < K < A

### 2.3 役の種類と強さ（弱い順）
1. **ハイカード（ノーペア）**
   - 役なし。最も高いカードで勝負
   - 例: A♠ K♥ 8♦ 5♣ 3♠

2. **ワンペア**
   - 同じランクのカード2枚
   - 例: K♠ K♥ 9♦ 5♣ 2♠

3. **ツーペア**
   - 同じランクのカード2枚が2組
   - 例: K♠ K♥ 5♦ 5♣ 2♠

4. **スリーカード（スリーオブアカインド）**
   - 同じランクのカード3枚
   - 例: 9♠ 9♥ 9♦ K♣ 3♠

5. **ストレート**
   - 連続する5枚のカード（スートは関係なし）
   - 例: 9♠ 8♥ 7♦ 6♣ 5♠
   - A-2-3-4-5（最も弱いストレート）と10-J-Q-K-A（最も強いストレート）も有効

6. **フラッシュ**
   - 同じスートのカード5枚（数字は連続していなくてもよい）
   - 例: K♠ 10♠ 7♠ 5♠ 2♠

7. **フルハウス**
   - スリーカード + ワンペア
   - 例: K♠ K♥ K♦ 5♣ 5♠

8. **フォーカード（フォーオブアカインド）**
   - 同じランクのカード4枚
   - 例: 9♠ 9♥ 9♦ 9♣ K♠

9. **ストレートフラッシュ**
   - ストレート + フラッシュ（連続する同じスートのカード5枚）
   - 例: 9♠ 8♠ 7♠ 6♠ 5♠

10. **ロイヤルストレートフラッシュ**
    - 10-J-Q-K-Aのストレートフラッシュ
    - 例: A♠ K♠ Q♠ J♠ 10♠
    - 最強の役

### 2.4 役の比較ルール
- 同じ役の場合、構成するカードのランクで比較
- ワンペア同士: ペアのランクが高い方が勝ち
- ツーペア同士: 高い方のペアを比較、同じなら低い方のペアを比較
- ストレート同士: 最も高いカードで比較
- フラッシュ同士: 最も高いカードから順に比較
- それでも同じ場合は引き分け（ポット分配）

### 2.5 ベッティングアクション
1. **チェック（Check）**
   - チップを賭けずに次のプレイヤーに順番を回す
   - 誰もベットしていない場合のみ可能

2. **ベット（Bet）**
   - チップを賭ける
   - 最低ベット額: 10チップ（設定で変更可能）

3. **コール（Call）**
   - 前のプレイヤーと同額を賭ける

4. **レイズ（Raise）**
   - 前のプレイヤーより多く賭ける
   - 最低レイズ額: 前回のベット額の2倍

5. **フォールド（Fold）**
   - ゲームから降りる
   - それまで賭けたチップは失う

### 2.6 CPUの難易度設定
#### イージー
- ランダムな判断が多い
- ブラフをほとんどしない
- 弱い役でもコールすることがある

#### ノーマル
- 役の強さに応じた判断
- 時々ブラフを使う
- バランスの取れたプレイ

#### ハード
- 戦略的な判断
- 頻繁にブラフを使う
- プレイヤーの傾向を読む
- 最適な交換枚数を選択

---

## 3. 画面設計

### 3.1 ゲーム開始画面
#### 表示要素
- ゲームタイトル「ポーカー」
- プレイヤー人数選択（2人/3人/4人）
- CPU難易度選択（イージー/ノーマル/ハード）
- 初期チップ設定（500/1000/2000）
- アンティ設定（5/10/20）
- ゲーム開始ボタン
- ルール説明セクション
- 統計情報（勝率、最高チップ数など）
- 言語切替ボタン

#### レイアウト
```
┌─────────────────────────────────┐
│  [GAME PORTAL]    🌐 言語 ☰     │
├─────────────────────────────────┤
│                                 │
│       🃏 ポーカー                │
│     (ファイブカードドロー)        │
│                                 │
│  ━━ ゲーム設定 ━━━━━━━━━━━━━   │
│                                 │
│  プレイヤー人数:                 │
│  ○ 2人  ○ 3人  ● 4人           │
│                                 │
│  CPU難易度:                      │
│  ○ イージー ● ノーマル ○ ハード  │
│                                 │
│  初期チップ: [1000▼]            │
│  アンティ: [10▼]                │
│                                 │
│  ━━ 統計情報 ━━━━━━━━━━━━━━   │
│  総ゲーム数: 42                  │
│  勝率: 55.5%                     │
│  最高チップ: 5,432               │
│  最高役: ストレートフラッシュ     │
│                                 │
│  ℹ️ ゲームルール                │
│  ・5枚のカードで役を作る          │
│  ・ドローでカード交換可能         │
│  ・最も強い役が勝利              │
│                                 │
│      [ゲーム開始]                │
│                                 │
└─────────────────────────────────┘
```

### 3.2 ゲームプレイ画面
#### 表示要素
- **ポット表示**: 現在のポット額
- **プレイヤー情報**:
  - プレイヤー名
  - 残りチップ数
  - 現在のベット額
  - ステータス（アクティブ/フォールド/オールイン）
  - プレイヤーカード（自分は表、CPUは裏）
- **コミュニティエリア**:
  - 現在のラウンド表示（配布/第1ベット/ドロー/第2ベット/ショーダウン）
  - ディーラーボタン
- **自分の手札**: 5枚のカード（選択可能）
- **アクションボタン**:
  - チェック/ベット/コール/レイズ/フォールド
  - ドローボタン（ドロー時）
  - スタンドボタン（ドロー時）
- **ベット額スライダー**: レイズ時の金額調整
- **役判定表示**: 現在の手札の役
- **ゲーム情報パネル**:
  - ターン表示
  - アクション履歴
- **メニューボタン**: 設定、ルール確認、ゲーム終了

#### レイアウト（4人プレイ時）
```
┌─────────────────────────────────────────┐
│  ポーカー          POT: 120💰   ☰      │
├─────────────────────────────────────────┤
│                                         │
│    [CPU1]                [CPU2]         │
│    💰 850                💰 920         │
│    Bet: 30               Bet: 30        │
│    🂠🂠🂠🂠🂠            🂠🂠🂠🂠🂠        │
│                                         │
│              ━━━━━━━━━                 │
│              💰 POT: 120                │
│              ━━━━━━━━━                 │
│              ラウンド: 第1ベット         │
│              ディーラー: [D] YOU         │
│              ━━━━━━━━━                 │
│                                         │
│    [CPU3]              [YOU] ⭐         │
│    💰 780              💰 1,050         │
│    Bet: 30             Bet: 30          │
│    🂠🂠🂠🂠🂠          🂡🂮🂸🃅🃎         │
│                                         │
├─────────────────────────────────────────┤
│  現在の役: ワンペア (K)                   │
│                                         │
│  [カード選択してドロー]                   │
│  ☑️🂡 ☐🂮 ☐🂸 ☐🃅 ☑️🃎                 │
│                                         │
│  [チェック] [ベット] [コール] [レイズ]    │
│  [フォールド]                            │
│                                         │
│  レイズ額: [━━●━━━] 60💰              │
└─────────────────────────────────────────┘
```

### 3.3 ショーダウン画面
#### 表示要素
- 全プレイヤーの手札公開
- 各プレイヤーの役表示
- 勝者のハイライト
- 獲得チップ表示
- 次のゲームボタン
- ゲーム終了ボタン

#### レイアウト
```
┌─────────────────────────────────┐
│         🏆 ショーダウン 🏆       │
├─────────────────────────────────┤
│                                 │
│  [CPU1] - フォールド             │
│  💰 850                         │
│                                 │
│  [CPU2] - ツーペア (K, 9)       │
│  💰 920                         │
│  🂮🂾🃉🃙🃅                      │
│                                 │
│  [CPU3] - ワンペア (Q)          │
│  💰 780                         │
│  🂭🂽🂸🃃🃏                      │
│                                 │
│  ✨ [YOU] - スリーカード (A) ✨  │
│  💰 1,050 → 1,170 (+120)        │
│  🂡🂱🃁🂸🃎                      │
│                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━    │
│  🎉 勝者: YOU                    │
│  獲得チップ: 120💰              │
│  ━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                 │
│   [次のゲーム]  [ゲーム終了]     │
│                                 │
└─────────────────────────────────┘
```

### 3.4 ゲーム終了画面
#### 表示要素
- 最終順位
- 各プレイヤーの最終チップ数
- ゲーム統計（ハンド数、勝率、最高役など）
- もう一度プレイボタン
- メインメニューボタン

---

## 4. 機能要件

### 4.1 ゲームフロー
1. **ゲーム開始**
   - プレイヤー人数、難易度、初期設定を選択
   - ゲーム開始ボタンをクリック

2. **アンティ支払い**
   - 全プレイヤーが自動的にアンティを支払う

3. **カード配布**
   - 各プレイヤーに5枚ずつカードを配る
   - アニメーション表示

4. **第1ベッティングラウンド**
   - ディーラーの左から順にアクション
   - プレイヤーの番: ボタンで選択
   - CPUの番: 自動判断（思考時間表示）

5. **ドローフェーズ**
   - 残っているプレイヤーがカード交換
   - 0～5枚を選択可能
   - 交換カードをアニメーションで配布

6. **第2ベッティングラウンド**
   - 再度ベッティング

7. **ショーダウン**
   - 手札を公開
   - 役を判定
   - 勝者を決定
   - チップを分配

8. **次のゲーム or 終了**
   - チップがなくなったプレイヤーは脱落
   - 1人になるまで or プレイヤーが終了を選択

### 4.2 カード管理
- **デッキ生成**: 52枚のカードをランダムにシャッフル
- **カード配布**: デッキから順に配る
- **カード交換**: 選択されたカードを捨て、新しいカードを配る
- **デッキ再生成**: カードが足りなくなったら再シャッフル

### 4.3 役判定機能
- **自動判定**: 手札を自動で判定し、最も強い役を表示
- **リアルタイム表示**: カード選択中も現在の役を表示
- **ドロー後の役**: 交換後の役を即座に表示
- **比較機能**: ショーダウン時に全プレイヤーの役を比較

### 4.4 CPUの思考ロジック
#### イージー
- 役の強さによる基本的な判断
- ペア以上でベット、それ以下でチェック/フォールド
- ドロー: ペアを残す程度

#### ノーマル
- 役の強さと期待値を考慮
- ポット額とベット額の比率で判断
- 時々ブラフ（20%）
- ドロー: 最適な枚数を計算

#### ハード
- 高度な戦略
- プレイヤーのベットパターンを記憶
- ブラフの頻度増加（30%）
- レイズを積極的に使用
- ポジションを考慮した判断

### 4.5 ベッティング管理
- **ポット管理**: 全員のベット額を合計
- **ベット額チェック**: 残りチップを超えるベット不可
- **オールイン処理**: チップ全額を賭ける
- **サイドポット**: オールインがあった場合の複数ポット管理

### 4.6 アニメーション
- **カード配布**: 1枚ずつアニメーションで配る
- **カード交換**: カードが裏返ってシャッフル
- **チップ移動**: ベット時にポットへ移動
- **勝利演出**: 勝者のカードをハイライト
- **役の表示**: 役が完成した時のエフェクト

### 4.7 統計機能
- **プレイ履歴**:
  - 総ゲーム数
  - 勝利数・敗北数
  - 勝率
- **役の統計**:
  - 各役の成立回数
  - 最高役
  - ロイヤルストレートフラッシュの回数
- **チップ統計**:
  - 最高チップ数
  - 平均チップ数
  - 総獲得チップ
- **グラフ表示**: チップの推移をグラフ化

### 4.8 設定機能
- **アニメーション速度**: 速い/普通/遅い
- **サウンド**: ON/OFF、音量調整
- **オートプレイ**: CPU同士の対戦を観戦
- **ルール表示**: いつでもルールを確認可能

---

## 5. UI/UXデザイン

### 5.1 デザインコンセプト
- **カジノテーブル風**: 緑色のフェルト背景
- **リアルなカード**: 実際のトランプカードのデザイン
- **直感的な操作**: ドラッグ&ドロップでカード選択
- **わかりやすい情報**: 役の強さ、チップ数を明確に表示

### 5.2 カラーテーマ
- **背景**: ダークグリーン（#2d5016）
- **カード**: 白（#ffffff）
- **テキスト**: ゴールド（#ffd700）、白（#ffffff）
- **ボタン**: 
  - ベット/レイズ: 赤系（#dc3545）
  - チェック/コール: 青系（#0d6efd）
  - フォールド: グレー系（#6c757d）
- **アクセント**: ゴールド、シルバー

### 5.3 カードデザイン
- **表面**: 
  - スート記号（♠♥♦♣）
  - ランク（A, 2-10, J, Q, K）
  - 標準的なトランプデザイン
- **裏面**: 
  - 模様入りの青色デザイン

### 5.4 レスポンシブ対応
- **デスクトップ（1920×1080以上）**: 
  - 大きなカード表示
  - 全情報を一画面に表示
- **タブレット（768×1024）**: 
  - カードサイズを調整
  - ボタン配置を最適化
- **スマートフォン（375×667以上）**: 
  - 縦画面対応
  - カードを小さく表示
  - ボタンを大きくタップしやすく

---

## 6. 技術仕様

### 6.1 使用技術
- **HTML5**: 構造とセマンティック
- **CSS3**: スタイリング、アニメーション
- **JavaScript (ES6+)**: ゲームロジック
- **LocalStorage**: データ保存

### 6.2 ファイル構成
```
/
├── index.html              # メインページ
├── poker.html              # ポーカーゲームページ
├── assets/
│   ├── css/
│   │   ├── styles.css      # 共通スタイル
│   │   └── poker.css       # ポーカー専用スタイル
│   ├── js/
│   │   ├── i18n.js         # 多言語対応
│   │   ├── game-stats.js   # 統計管理
│   │   └── poker.js        # ポーカーロジック
│   └── img/
│       └── poker/
│           ├── cards/      # カード画像
│           └── poker_top.jpg  # サムネイル
└── doc/
    └── 10_Poker_requirements_document.md
```

### 6.3 データ構造
#### ゲーム状態
```javascript
{
  players: [
    {
      id: 'player1',
      name: 'YOU',
      chips: 1000,
      hand: [Card, Card, Card, Card, Card],
      bet: 0,
      status: 'active', // active, folded, allin
      isDealer: true,
      isHuman: true
    },
    // ... CPU players
  ],
  pot: 0,
  deck: [Card...],
  currentPlayer: 0,
  round: 'betting1', // betting1, draw, betting2, showdown
  ante: 10,
  minBet: 10,
  difficulty: 'normal'
}
```

#### カード構造
```javascript
{
  suit: 'spades', // spades, hearts, diamonds, clubs
  rank: 'A',      // A, 2-10, J, Q, K
  value: 14       // 2-14 (A=14)
}
```

#### 役判定結果
```javascript
{
  rank: 9,              // 0-9 (0=ハイカード, 9=ロイヤルフラッシュ)
  name: 'Royal Flush',
  cards: [Card...],     // 役を構成するカード
  highCards: [14, 13, 12, 11, 10]  // 比較用
}
```

### 6.4 主要な関数
```javascript
// カード管理
createDeck()                    // デッキ生成
shuffleDeck(deck)               // シャッフル
dealCard(deck)                  // カードを1枚配る
dealHands(deck, numPlayers)     // 全員に配る

// 役判定
evaluateHand(cards)             // 役を判定
compareHands(hand1, hand2)      // 役を比較
isRoyalFlush(cards)             // ロイヤルフラッシュ判定
isStraightFlush(cards)          // ストレートフラッシュ判定
isFourOfAKind(cards)            // フォーカード判定
isFullHouse(cards)              // フルハウス判定
isFlush(cards)                  // フラッシュ判定
isStraight(cards)               // ストレート判定
isThreeOfAKind(cards)           // スリーカード判定
isTwoPair(cards)                // ツーペア判定
isOnePair(cards)                // ワンペア判定

// ベッティング
placeBet(player, amount)        // ベットを置く
collectBets()                   // ベットをポットに集める
distributeWinnings(winner)      // 勝者にチップ配分

// CPU思考
cpuDecideAction(player, gameState)  // CPUのアクション決定
cpuSelectDrawCards(hand)            // 交換カード選択
calculateHandStrength(hand)         // 手札の強さ評価
```

---

## 7. 多言語対応

### 7.1 対応言語
- 日本語（デフォルト）
- 英語
- 中国語（簡体字）
- ヒンディー語
- スペイン語
- フランス語

### 7.2 翻訳が必要な要素
- ゲームタイトル、説明
- ルール説明
- ボタンラベル（ベット、コール、レイズ、フォールド、チェック）
- 役の名前
- ゲームメッセージ（「あなたの番です」など）
- 統計情報のラベル

---

## 8. テストケース

### 8.1 役判定テスト
- ロイヤルフラッシュの正しい判定
- ストレートフラッシュの判定
- A-2-3-4-5のストレート判定
- 同じ役同士の強さ比較
- すべての役の正しい判定

### 8.2 ベッティングテスト
- オールイン処理
- サイドポット生成
- 不正なベット額の拒否
- チップ残高の正しい更新

### 8.3 ゲームフローテスト
- 正常なゲーム進行
- 全員フォールドの処理
- 1人のみ残った場合
- ディーラーの移動

### 8.4 CPU動作テスト
- 各難易度での適切な判断
- ブラフの頻度
- 不正な行動をしないこと

---

## 9. 実装優先順位

### Phase 1: 基本機能（MVP）
- カード表示とデッキ管理
- 役判定ロジック
- 2人対戦（プレイヤー vs CPU 1人）
- 基本的なベッティング（チェック、ベット、コール、フォールド）
- ドロー機能
- 勝敗判定

### Phase 2: ゲーム拡張
- 3～4人対戦
- レイズ機能
- CPU難易度設定（イージー、ノーマル、ハード）
- オールイン、サイドポット
- アニメーション追加

### Phase 3: UI/UX改善
- リアルなカードデザイン
- チップアニメーション
- サウンドエフェクト
- レスポンシブ対応

### Phase 4: 追加機能
- 統計機能（勝率、役の履歴）
- 役の説明ツールチップ
- オートプレイ（観戦モード）
- チュートリアルモード
- 多言語対応

---

## 10. 参考資料

### 10.1 ポーカールール
- ファイブカードドローの公式ルール
- 役の強さと確率

### 10.2 デザイン参考
- オンラインカジノのポーカーUI
- トランプカードのデザイン

### 10.3 アルゴリズム
- 役判定アルゴリズム
- CPUの思考ロジック（モンテカルロ法、期待値計算）
- ポーカーAIの基本戦略
